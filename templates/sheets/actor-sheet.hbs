<form class="{{cssClass}} flexcol" autocomplete="off">

    <!-- Header -->
    <header class="sheet-header">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" />
        <div class="header-fields">
            <h1 class="charname"><input name="name" type="text" value="{{actor.name}}" placeholder="Character Name" /></h1>
            <div class="header-grid">
                <div class="pathway">Pathway: <input name="system.pathway" type="text" value="{{system.pathway}}" placeholder="e.g., Seer" /></div>
                <div class="sequence">Sequence: <input name="system.sequenceName" type="text" value="{{system.sequenceName}}" placeholder="e.g., Clown" /></div>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="main">Main</a>
        <a class="item" data-tab="inventory">Inventory</a>
        <a class="item" data-tab="biography">Biography</a>
    </nav>

    <!-- Sheet Body (Tab Content) -->
    <section class="sheet-body">

        <!-- Main Tab -->
        <div class="tab main" data-group="primary" data-tab="main">
            <div class="main-grid">
                <!-- Left Column: Sequence Abilities -->
                <div class="left-panel">
                    <div class="panel-label">Sequence Abilities</div>
                    <div class="sequence-abilities">
                        {{#each context.sequenceAbilities as |seq|}}
                        <div class="sequence-group">
                            <h3 class="sequence-header" data-sequence="{{seq.level}}">
                                <i class="fas fa-chevron-right"></i> Sequence {{seq.level}}
                            </h3>
                            <ol class="ability-list">
                                {{#each seq.abilities as |ability|}}
                                <li class="item ability-item" data-item-id="{{ability._id}}" data-action="edit-item" title="Click to edit {{ability.name}}">
                                    <img src="{{ability.img}}" width="24" height="24" />
                                    {{ability.name}}
                                </li>
                                {{/each}}
                            </ol>
                        </div>
                        {{/each}}
                    </div>
                </div>

                <!-- Center Column: Core Stats & Skills -->
                <div class="center-panel">
                    <div class="attributes-panel">
                        <div class="panel-label">{{localize "LOM.Attributes"}}</div>
                        {{#each config.attributes as |label key|}}
                        <div class="attribute-row">
                            <a class="attribute-label rollable" data-attribute-key="{{key}}">{{localize label}}</a>
                            <input class="attribute-value" type="text" name="system.attributes.{{key}}.value" value="{{(lookup ../system.attributes key).value}}" data-dtype="Number" />
                            <span class="attribute-mod">{{numberFormat (lookup ../system.attributes key).mod decimals=0 sign=true}}</span>
                        </div>
                        {{/each}}
                    </div>
                    <div class="skills-panel angled-box">
                        <div class="box-label">{{localize "LOM.Skills"}}</div>
                        <div class="skills-list">
                            {{#each config.skills as |skill key|}}
                            <div class="skill-row">
                                <input type="checkbox" id="skill-check-{{key}}" name="system.skills.{{key}}.proficient" {{checked (lookup ../system.skills key).proficient}} />
                                <a class="skill-label rollable" data-skill-key="{{key}}">
                                    {{localize skill.label}}
                                    <span class="skill-attribute">({{localize (lookup ../config.attributes skill.attribute)}})</span>
                                </a>
                            </div>
                            {{/each}}
                        </div>
                    </div>
                </div>

                <!-- Right Column: Vitals -->
                <div class="right-panel">
                    <div class="panel-label">Vitals</div>
                    <div class="vitals-grid">
                        <!-- Health Counter -->
                        <div class="resource-counter" data-resource-path="system.health">
                            <img class="resource-icon" src="systems/LordOfMysteries/assets/icons/heart.svg" title="Health (L/R Click: +/- 1, Shift+L/R Click: +/- 5)">
                            <div class="resource-values">
                                <span class="current-value">{{system.health.value}}</span>
                                <span class="separator">/</span>
                                <span class="max-value">{{system.health.max}}</span>
                            </div>
                            <div class="resource-controls">
                                <a class="control-button" data-action="manual-set-resource" title="Manually Set Value"><i class="fas fa-pencil-alt"></i></a>
                                {{#if isGM}}
                                <a class="control-button" data-action="edit-max-resource" data-change="1" title="Increase Max Value"><i class="fas fa-plus-circle"></i></a>
                                <a class="control-button" data-action="edit-max-resource" data-change="-1" title="Decrease Max Value"><i class="fas fa-minus-circle"></i></a>
                                {{/if}}
                            </div>
                        </div>
                        <!-- Mental Health Counter -->
                        <div class="resource-counter" data-resource-path="system.mentalHealth">
                            <img class="resource-icon" src="systems/LordOfMysteries/assets/icons/brain-alt.svg" title="Mental Health (L/R Click: +/- 1, Shift+L/R Click: +/- 5)">
                            <div class="resource-values">
                                <span class="current-value">{{system.mentalHealth.value}}</span>
                                <span class="separator">/</span>
                                <span class="max-value">{{system.mentalHealth.max}}</span>
                            </div>
                            <div class="resource-controls">
                                <a class="control-button" data-action="manual-set-resource" title="Manually Set Value"><i class="fas fa-pencil-alt"></i></a>
                                {{#if isGM}}
                                <a class="control-button" data-action="edit-max-resource" data-change="1" title="Increase Max Value"><i class="fas fa-plus-circle"></i></a>
                                <a class="control-button" data-action="edit-max-resource" data-change="-1" title="Decrease Max Value"><i class="fas fa-minus-circle"></i></a>
                                {{/if}}
                            </div>
                        </div>
                        <!-- Physical Armor Counter -->
                        <div class="resource-counter single" data-resource-path="system.armor.physical">
                            <img class="resource-icon" src="systems/LordOfMysteries/assets/icons/shield.svg" title="Physical Armor (L/R Click: +/- 1, Shift+L/R Click: +/- 5)">
                            <div class="resource-values">
                                <span class="current-value">{{system.armor.physical.value}}</span>
                            </div>
                            <div class="resource-controls">
                                <a class="control-button" data-action="manual-set-resource" title="Manually Set Value"><i class="fas fa-pencil-alt"></i></a>
                            </div>
                        </div>
                        <!-- Magical Armor Counter -->
                        <div class="resource-counter single" data-resource-path="system.armor.magical">
                            <img class="resource-icon" src="systems/LordOfMysteries/assets/icons/magic-orb.svg" title="Magical Armor (L/R Click: +/- 1, Shift+L/R Click: +/- 5)">
                            <div class="resource-values">
                                <span class="current-value">{{system.armor.magical.value}}</span>
                            </div>
                            <div class="resource-controls">
                                <a class="control-button" data-action="manual-set-resource" title="Manually Set Value"><i class="fas fa-pencil-alt"></i></a>
                            </div>
                        </div>
                        <!-- Movement Display -->
                        <div class="resource-counter single movement-display">
                            <label>Movement</label>
                            <div class="movement-value">{{system.movement.total}} {{system.movement.units}}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div class="tab inventory" data-group="primary" data-tab="inventory">
            <ol class="items-list">
                <li class="item-header flexrow">
                    <div class="item-name">{{localize "LOM.Item.Name"}}</div>
                    <div class="item-controls">
                        <a class="item-control item-create" data-type="weapon" title="Create Weapon"><i class="fas fa-gavel"></i></a>
                        <a class="item-control item-create" data-type="armor" title="Create Armor"><i class="fas fa-shield-alt"></i></a>
                        <a class="item-control item-create" data-type="equipment" title="Create Equipment"><i class="fas fa-box"></i></a>
                        <a class="item-control item-create" data-type="ability" title="Create Ability"><i class="fas fa-star"></i></a>
                        <a class="item-control item-create" data-type="consumable" title="Create Consumable"><i class="fas fa-flask"></i></a>
                    </div>
                </li>
                {{#each context.inventory as |section|}}
                <li class="item-header flexrow"><h3>{{localize section.label}}</h3></li>
                {{#each section.items as |item id|}}
                <li class="item flexrow" data-item-id="{{item._id}}" title="{{item.name}}&#10;&#10;{{stripTags item.system.description}}">
                    <div class="item-image">
                        <a class="item-control item-edit" title="Edit {{item.name}}"><img src="{{item.img}}" alt="{{item.name}}" /></a>
                    </div>
                    <div class="item-name">{{item.name}}</div>
                    <div class="item-controls">
                        <a class="item-control item-edit" title="Edit Item"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" title="Delete Item"><i class="fas fa-trash"></i></a>
                    </div>
                </li>
                {{/each}}
                {{/each}}
            </ol>
        </div>

        <!-- Biography Tab -->
        <div class="tab biography" data-group="primary" data-tab="biography">
            {{editor biographyHTML target="system.biography" button=true owner=owner editable=editable}}
        </div>

    </section>
</form>
